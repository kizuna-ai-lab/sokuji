name = "sokuji-backend"
main = "src/index.ts"
compatibility_date = "2024-01-01"

[observability]
enabled = true
head_sampling_rate = 1.0  # logs 100% of requests, adjust as needed

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "sokuji-db-prod"
database_id = "90365899-4d8d-47c7-ad53-e2ab158a4707"

# KV Namespaces
[[kv_namespaces]]
binding = "WALLET_CACHE"
id = "5ba622f79af24845bfe54141dc0ba400"

# Durable Objects for WebSocket connections
[[durable_objects.bindings]]
name = "REALTIME_RELAY"
class_name = "RealtimeRelayDurableObject"

# Durable Object migrations
[[migrations]]
tag = "v1"
new_classes = ["RealtimeRelayDurableObject"]

# Environment Variables (use .dev.vars for local development)
[vars]
ENVIRONMENT = "production"
FRONTEND_URL = "https://sokuji.kizuna.ai"

# Routes for Production Environment
[[routes]]
pattern = "sokuji.kizuna.ai/api/*"
zone_name = "kizuna.ai"

[[routes]]
pattern = "api.sokuji.kizuna.ai/*"
zone_name = "kizuna.ai"

# Alternative production API endpoint
[[routes]]
pattern = "sokuji-api.kizuna.ai/*"
zone_name = "kizuna.ai"